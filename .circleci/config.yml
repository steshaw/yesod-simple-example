version: 2
jobs:

  build:

    docker:
      - image: steshaw/bt-build-base:0.1.19

    working_directory: /app

    steps:

      - checkout

      - run:
          name: Set file modification times to match git modification times
          command: scripts/git-sync-modification-times

      - restore_cache:
          keys:
            - stack-{{.Branch}}-{{.Revision}}
            - stack-{{.Branch}}
            - stack-master

      - run:
          name: Stack Version
          command: |
            which stack
            stack --version

      - run:
          name: Build
          command: |
            scripts/build broken --system-ghc

      - save_cache:
          key: stack-{{.Branch}}-{{.Revision}}
          paths:
            - ~/.stack
            - .stack-work
